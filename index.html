<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rick Jump: Defender</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Courier New', sans-serif; touch-action: none; }
        canvas { display: block; background: linear-gradient(#000428, #004e92); }
        
        #ui { position: absolute; top: 10px; width: 100%; text-align: center; color: white; font-size: 24px; pointer-events: none; z-index: 10; }
        #cooldown-bar { width: 100px; height: 10px; background: #333; margin: 5px auto; border: 1px solid white; }
        #cooldown-fill { width: 100%; height: 100%; background: #0ff; transition: width 0.1s; }

        /* DIN RICKROLL KODE */
        #rickRollOverlay {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; background: black;
            z-index: 9999; flex-direction: column; align-items: center; justify-content: center;
        }
        #rickVideo { width: 100%; max-height: 80vh; }
        #rickRollOverlay button { margin-top: 20px; padding: 15px 30px; font-size: 20px; cursor: pointer; border-radius: 10px; font-weight: bold; }

        /* KONTROLLER */
        .atk-btn {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 80px; height: 80px; background: rgba(255,215,0,0.3);
            border: 3px solid gold; border-radius: 50%; color: gold;
            font-size: 40px; display: flex; align-items: center; justify-content: center;
            z-index: 20; user-select: none;
        }
        .atk-btn:active { background: gold; color: black; }
    </style>
</head>
<body>

    <div id="ui">
        SCORE: <span id="scoreVal">0</span>
        <div id="cooldown-bar"><div id="cooldown-fill"></div></div>
    </div>

    <div class="atk-btn" id="atkBtn">ðŸŽ¤</div>

    <div id="rickRollOverlay">
        <video id="rickVideo" playsinline loop>
            <source src="https://dn721809.ca.archive.org/0/items/youtube-xvFZjo5PgG0/xvFZjo5PgG0.mp4" type="video/mp4">
        </video>
        <button onclick="location.reload()">PRÃ˜V IGJEN</button>
    </div>

    <canvas id="game"></canvas>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let score = 0;
    let gameActive = true;
    const gravity = 0.38;
    const jumpStrength = -13;
    
    let rick = {
        x: canvas.width/2, y: canvas.height-200, w: 40, h: 40,
        vx: 0, vy: 0, atkCooldown: 0, atkActive: 0
    };

    let platforms = [];
    let enemies = [];
    const platW = 75, platH = 15;

    function spawnPlatform(y, isFirst = false) {
        let type = isFirst ? 'normal' : ['normal', 'normal', 'moving', 'break', 'boost'][Math.floor(Math.random()*5)];
        let x = Math.random() * (canvas.width - platW);
        let p = { x, y, type, hits: 0, vx: (type === 'moving' ? 2 : 0) };
        platforms.push(p);

        if (!isFirst && Math.random() > 0.7) {
            enemies.push({ x: x + 10, y: y - 30, w: 25, h: 25, vx: 1.5, parent: p });
        }
    }

    function init() {
        for(let i=0; i<6; i++) spawnPlatform(canvas.height - (i * 140), i === 0);
    }

    // Input
    window.addEventListener('touchstart', e => {
        if(e.target.id === 'atkBtn') {
            if(rick.atkCooldown <= 0) {
                rick.atkActive = 20; rick.atkCooldown = 300; // 5 sek (60fps * 5)
            }
            return;
        }
        rick.vx = (e.touches[0].clientX < canvas.width/2) ? -6 : 6;
    });
    window.addEventListener('touchend', () => rick.vx = 0);

    function triggerRickRoll() {
        gameActive = false;
        document.getElementById('rickRollOverlay').style.display = 'flex';
        document.getElementById('rickVideo').play().catch(() => {});
    }

    function update() {
        if(!gameActive) return;

        rick.vy += gravity;
        rick.y += rick.vy;
        rick.x += rick.vx;

        if(rick.atkCooldown > 0) {
            rick.atkCooldown--;
            document.getElementById('cooldown-fill').style.width = (1 - rick.atkCooldown/300)*100 + "%";
        }
        if(rick.atkActive > 0) rick.atkActive--;

        // Wrap
        if(rick.x > canvas.width) rick.x = -rick.w;
        if(rick.x < -rick.w) rick.x = canvas.width;

        // Plattformer
        platforms.forEach((p, i) => {
            if(p.type === 'moving') {
                p.x += p.vx;
                if(p.x < 0 || p.x > canvas.width - platW) p.vx *= -1;
            }

            if(rick.vy > 0 && rick.x+rick.w > p.x && rick.x < p.x+platW && rick.y+rick.h > p.y && rick.y+rick.h < p.y+platH+10) {
                if(p.type === 'break') {
                    p.hits++;
                    if(p.hits > 1) platforms.splice(i, 1);
                    else rick.vy = jumpStrength;
                } else if(p.type === 'boost') {
                    rick.vy = jumpStrength * 1.8;
                } else {
                    rick.vy = jumpStrength;
                }
            }
        });

        // Fiender
        enemies.forEach((en, i) => {
            en.x += en.vx;
            if(en.x < en.parent.x || en.x > en.parent.x + platW - en.w) en.vx *= -1;
            en.y = en.parent.y - 30;

            // Bli truffet av fiende
            if(rick.x < en.x+en.w && rick.x+rick.w > en.x && rick.y < en.y+en.h && rick.y+rick.h > en.y) {
                rick.vx = (rick.x < en.x) ? -15 : 15; // Knockback
            }

            // Angrep fiende
            if(rick.atkActive > 0) {
                let dist = Math.hypot(rick.x - en.x, rick.y - en.y);
                if(dist < 150) enemies.splice(i, 1);
            }
        });

        // Scroll
        if(rick.y < canvas.height/2) {
            let d = canvas.height/2 - rick.y;
            rick.y = canvas.height/2;
            score += Math.floor(d/5);
            document.getElementById('scoreVal').innerText = score;
            platforms.forEach((p, i) => {
                p.y += d;
                if(p.y > canvas.height) { platforms.splice(i, 1); spawnPlatform(0); }
            });
        }

        if(rick.y > canvas.height) triggerRickRoll();

        draw();
        requestAnimationFrame(update);
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Tegn Angrep-sirkel
        if(rick.atkActive > 0) {
            ctx.fillStyle = `rgba(0, 255, 255, ${rick.atkActive/20})`;
            ctx.beginPath();
            ctx.arc(rick.x + 20, rick.y + 20, 120, 0, Math.PI*2);
            ctx.fill();
        }

        // Tegn Rick
        ctx.fillStyle = '#ffcc99';
        ctx.fillRect(rick.x, rick.y, rick.w, rick.h);
        ctx.fillStyle = '#663300'; ctx.fillRect(rick.x, rick.y, rick.w, 10); // HÃ¥r

        // Tegn Plattformer
        platforms.forEach(p => {
            if(p.type === 'break') ctx.fillStyle = p.hits === 1 ? '#900' : '#f60';
            else if(p.type === 'moving') ctx.fillStyle = '#0cf';
            else if(p.type === 'boost') ctx.fillStyle = '#ff0';
            else ctx.fillStyle = '#4f4';
            ctx.fillRect(p.x, p.y, platW, platH);
        });

        // Tegn Fiender
        ctx.fillStyle = '#a0f';
        enemies.forEach(en => ctx.fillRect(en.x, en.y, en.w, en.h));
    }

    init();
    update();
</script>
</body>
</html>
